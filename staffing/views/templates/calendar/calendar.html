{% extends 'layout.html' %}

{% block head %}
    {{ super() }}
    <style>
        @font-face {
          font-family: condensed-font;
          src: url("{{ url_for('static', filename='fonts/sans_condensed.ttf')}}") format("truetype");
        }

        .day-col{
            width:14.2857142857142857%;
        }
        .full_day_display{
            position:absolute;
            white-space: nowrap;
            overflow:hidden;
            text-overflow:ellipsis;
            background-color:white;
            width:14.2857142857142857%;
            z-index:3000;
            display:none;
        }

      .day-content{
                font-family: condensed-font, sans-serif;
                font-size:1.25em;
                line-height:1;
                white-space: nowrap;
                overflow:hidden;
                text-overflow:ellipsis;
                cursor:pointer;
        }
        .day-name, .month-name{
            text-align:center;
            font-weight:bold;
        }
        .month-name{
            padding:6pt 0;
            margin:0;
        }
        #calendar-contain{
            margin:0 auto;
            width:90%;
            max-width:1000px;
        }
        @media (max-width:993px){
            #calendar-contain{
                width:99%;
            }
        }
        
        #calendar-contain .w3-row p.w3-col {
            margin:0;
        }
        .day-cell{
            min-height:80pt
        }
        .day-number{
            text-align:right;
            font-weight:bold;
            padding-right:6pt;
        }
        .today {
            color:white;
            background-color:red;
        }
        .month_arrow{
            text-decoration:none;
        }
        #coverup{
            position:absolute;
            top:0;
            left:0;
            display:none;
            height:1000pt;
            width:100%;
            z-index:2000;
        }
        
        .theres-more {
            cursor:pointer;
        }
        
        .yours, .yours-caption {
            
            background-image: url('/static/images/check_mark.png');
            background-repeat: no-repeat;
            background-position: top left;
            padding-left:10pt;
            background-size: 8pt 8pt;
        }
        .yours-caption {
            padding-left:20pt;
            background-size: 12pt 12pt;
        }
        .yours-caption::before {
            content: 'Your Commitments';
        }
    </style>

    <script>
        function show_full_day(day_number){
            $('#full_day_display_'+day_number.toString()).show()
            $('#coverup').show()
        }
        function hide_full_day(){
            $('#coverup, .full_day_display').hide()
        }
    </script>
{% endblock head %}

{% block body %}
<div id="coverup" onclick="hide_full_day()">&nbsp;</div>
{% if cal_list %}
    {% set _ = calendar.setfirstweekday(calendar.SUNDAY) %}
    {% set event_list_position = 2 %} {# for my sanity #}
    <div id="calendar-contain">
        {% if g.user %}<p class="yours-caption">&nbsp;</p>{% endif %}
        <div class="w3-row">
            <p class="w3-large w3-primary-color month-name">
                <a class="month_arrow" href="{{ url_for('calendar.display')}}{{ last_month.month }}/{{ last_month.year }}">&#x3c;</a>&nbsp;&nbsp;
                {{ calendar.month_name[start_date.month]}} {{ start_date.year }}
                &nbsp;&nbsp;<a class="month_arrow" href="{{ url_for('calendar.display')}}{{ next_month.month }}/{{ next_month.year }}">&#x3e;</a>
            </p>
        <div class="w3-row">
            {%for day in calendar.weekheader(3).split(' ') %}
            <p class="w3-col w3-border w3-secondary-color day-name day-col">{{ day }}</p>
            {% endfor %}
        </div>
        {%for week in range(cal_list | length ) %}
        <div class="w3-row">
                {% for day in range(cal_list[week] | length ) %}
                {% set events_today = cal_list[week][day][event_list_position] | length %}
                {% set day_number = cal_list[week][day][0]%}
                {% set day_in_this_month = (day_number != 0)%}
                <div class="w3-col w3-border w3-white day-col day-cell" style="padding:0 2pt;max-length:">
                    {% if day_in_this_month %}
                    <div id="full_day_display_{{day_number}}" class="full_day_display w3-small w3-border">
                        <p class="day-number w3-primary-color">{{ day_number }}</p>
                        {% for event_num in range( events_today )%}
                            {% set event = event_data[cal_list[week][day][event_list_position][event_num]] %}
                            <p onclick="location='{{ url_for('calendar.event')}}{{event.event_id}}'" class="day-content {%if event.is_yours %}yours{% endif %}">{{event.calendar_title}}</p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <p class="day-number {% if today and start_date and today.day == day_number and today.month == start_date.month %}today{% endif %}">
                        {% if day_in_this_month %}{{ day_number }}{% else %}&nbsp;{% endif %}
                    </p>
                    <div class="w3-small">
                        {% for event_num in range( events_today )%}
                            {% if event_num <= 1 or events_today < 4 %}
                            {% set event = event_data[cal_list[week][day][event_list_position][event_num]] %}
                            <p onclick="location='{{ url_for('calendar.event')}}{{event.event_id}}'" class="day-content {%if event.is_yours %}yours{% endif %}">{{event.calendar_title}}</p>
                            {% endif %}
                        {% endfor %}
                        {# lump all the extra events into a "more" line #}
                        {% if events_today > 3 %}
                        <p class=" w3-primary-color theres-more" onclick="show_full_day({{day_number}})">&amp; {{ cal_list[week][day][2] | length - 2}} more...</p>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
        </div>
        {% endfor %}
    </div>
{% else %}
<h3>Well, that's odd... there's no calendar to display...</h3>
{% endif %}
{% endblock body %}
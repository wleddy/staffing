{% extends 'signup_layout.html' %}

{% block page_header %}
{% include 'roster_page_header.html' %}
{% endblock page_header %}

{% block body %}
    {% if not jobs or not is_admin %}
    <div class="w3-row w3-secondary-color job-contain " style="margin-top:-1px;">
         <h3>Sorry, there are no events in that date range</h3>
    </div>
    {% else %}
        {% set event_id = [0] %}
        {% set job_start_date = [''] %}
        {% set job_location_name = [''] %}
        {% for job in jobs %}
            {% if job.event_id != event_id[0] %}
            {# don't show event head again till event changes #}
            {% set _ = event_id.pop() %}
            {% set _ = event_id.append(job.event_id) %}
            {% set _ = job_start_date.pop() %}
            {% set _ = job_start_date.append('') %}
            {% set _ = job_location_name.pop() %}
            {% set _ = job_location_name.append('') %}
            <div id="act-{{ job.event_id }}" class="event-contain w3-row-padding w3-secondary-color w3-topbar" >        
                <div class="w3-col w3-half" >
                       <p class="w3-large">
                           <strong>{{ job.event_title }}</strong><br>
                           <span class="w3-small">Filled: {{ job.event_filled_positions | default("0", True) }} of {{ job.event_max_positions | default("0", True) }}</span>
                       </p>
                </div>
            </div>
            <div class="event-contain w3-row-padding w3-secondary-color" style="margin-top:0;">        
               <p class="w3-col w3-half w3-small" >
                   {% if job.event_manager_last_name %}Event Manager: {{ job.event_manager_first_name | default("")}} {{job.event_manager_last_name}}<br>{% endif %}
                   {% if job.event_manager_email %}Manager email: {{job.event_manager_email}}<br>{% endif %}
                   {% if job.event_manager_phone %}Manager phone: {{job.event_manager_phone}}<br>{% endif %}
               </p>
                <p class="w3-col w3-half w3-small" style="margin-top:0;">
                   {% if job.client_contact %}Client: {{job.client_contact}}<br>{% endif %}
                   {% if job.client_email %}Client email: {{job.client_email}}<br>{% endif %}
                   {% if job.client_phone %}Client phone: {{job.client_phone}}<br>{% endif %}
                   {% if job.client_website %}Client web: {{job.client_website | weblink }}{% endif %}
               </p>
            </div>
            {% if job.event_staff_info %}
            <div class="event-contain w3-row-padding w3-secondary-color" style="margin-top:0;">
                <div class="w3-col w3-half w3-small" >   
                   <p><strong>Staff Only Info...</strong></p>
                   <div class="w3-border" style="margin-left:6pt;padding:3pt;">
                       {{ job.event_staff_info | render_markdown }}
                   </div>
                   {% endif %}
                </div>
            </div>
            {% endif %} {# show event head? #}
            {# only show the date once within job list of same date #}
            {% if job.start_date[:10] != job_start_date[0] %}
                {% set _ = job_start_date.pop() %}
                {% set _ = job_start_date.append(job.start_date[:10]) %}
                {% set _ = job_location_name.pop() %}
                {% set _ = job_location_name.append('') %}
                <hr class="event-contain" style="margin-top:0;">
                <p class="event-contain w3-row w3-secondary-color" style="margin-top:0">
                    <strong>{{ job.start_date[:10] | abbr_date_string }}</strong>
                </p>
            {% endif %} {# show date? #}
            
            {% if job.job_loc_name != job_location_name[0] %}
                {% set _ = job_location_name.pop() %}
                {% set _ = job_location_name.append(job.job_loc_name) %}
                <p class="event-contain w3-row w3-secondary-color" style="margin-top:0;">
                    <strong>{{ job.job_loc_name }}</strong> 
                    {% if job.job_loc_w3w %}<a href="https://w3w.co/{{job.job_loc_w3w}}" target="_w3w" >Map...</a>
                    {% elif job.job_loc_lat and job.job_loc_lng %}<a href="#">Map...</a>{% endif %}
                </p>
            {% endif %} {# show loction? #}
           <div id="job-body{{job.job_id}}">
                {% include 'roster_job.html' %}
            </div>
    
        {% endfor %} {# jobs #}
    {% endif %}{# not jobs #}
{% endblock body %}
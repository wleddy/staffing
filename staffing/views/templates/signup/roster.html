{% extends 'signup_layout.html' %}

{% block page_header %}
{% endblock page_header %}

{% block body %}
    {% if not jobs or not is_admin %}
    <div class="w3-row w3-secondary-color job-contain " style="margin-top:-1px;">
         <h2>Sorry, there are no events currently planned</h2>
    </div>
    {% else %}
        {% set job_start_date = [''] %}
        {% set event_id = [0] %}
        {% for job in jobs %}
            {% if job.event_id != event_id[0] %}
            {# don't show event head again till event changes #}
            {% set _ = event_id.pop() %}
            {% set _ = event_id.append(job.event_id) %}
            {% set _ = job_start_date.pop() %}
            {% set _ = job_start_date.append('') %}
            <div id="act-{{ job.event_id }}" class="event-contain w3-row-padding w3-secondary-color w3-topbar" style="padding-bottom:6pt;">        
                <div class="w3-col w3-half w3-small" >
                       <p class="w3-large">
                           <strong>{{ job.event_title }}</strong>
                       </p>
                </div>
                <div class="w3-third " style="padding-left:4pt;">
                    <p>
                        <em>Where:</em> <strong>{{ job.event_loc_name | default("", True ) }}</strong> 
                        {% if job.event_loc_w3w %}<a href="https://w3w.co/{{job.event_loc_w3w}}" target="_w3w" >Map...</a>
                        {% elif job.event_loc_lat and job.event_loc_lng %}<a href="#">Map...</a>{% endif %}
                    </p>
                    {% set width_pct = job.event_filled_positions | default(0,True) / job.event_max_positions * 74 %}
                    {% if width_pct > 25.0 %}
                    <p class="w3-small">Filled: 
                        <a class="w3-button w3-primary-color w3-round-medium filled-bar" style="width:{{ width_pct }}%;"
                        >{{ job.event_filled_positions | default("0", True) }} of {{ job.event_max_positions | default("0", True) }}</a>
                    </p>
                    {% else %}
                    <p class="w3-small">Filled: 
                        <a class="w3-button w3-primary-color w3-round-medium filled-bar" style="width:{{ width_pct }}%;">&nbsp;</a>
                        &nbsp;{{ job.event_filled_positions | default("0", True) }} of {{ job.event_max_positions | default("0", True) }}
                    </p>
                    {% endif %}
                </div>
            </div>
            {% endif %} {# show event head? #}
            {# only show the date once within job list of same date #}
            {% if job.start_date[:10] != job_start_date[0] %}
                {% set _ = job_start_date.pop() %}
                {% set _ = job_start_date.append(job.start_date[:10]) %}
                <div class="w3-row w3-secondary-color job-contain job-date-contain" style="margin-top:-1px;">
                    <div class="w3-col l11 m11">
                        <hr style="margin:0 0 6pt 0;">
                        <p onclick="$('.job-date-container-{{ job.event_id }}-{{job.start_date[:10]}},.job-date-more-{{ job.event_id }}-{{job.start_date[:10]}}').toggle();"
                        style="cursor:pointer;">
                            <span class="w3-button w3-round-medium w3-primary-color job-date-more-{{ job.event_id }}-{{job.start_date[:10]}}" 
                            >+</span>
                            <span class=" w3-button w3-round-medium w3-primary-color job-date-container-{{ job.event_id }}-{{job.start_date[:10]}}" style="display:none;" 
                            >&ndash;</span>
                            <em>When:</em> <strong>{{ job.start_date[:10] | abbr_date_string }}</strong>
                        </p>
                    </div>
                </div>
            {% endif %} {# show date? #}
             <div class="job-date-container-{{ job.event_id }}-{{job.start_date[:10]}}" style="display:none;">
               <div id="job-body{{job.job_id}}">
                    {% include 'roster_job.html' %}
                </div>
            </div>
    
        {% endfor %} {# jobs #}
    {% endif %}{# not jobs #}
{% endblock body %}